Generate PowerShell script using latest module documentation from Context7.

## Usage

```bash
/ps-script "[detailed description of what the script should do]"
```

## Behavior

This command generates production-ready PowerShell scripts by:

1. **Fetch Latest Docs**: Use Context7 MCP to get current module documentation
2. **Identify Modules**: Determine which PowerShell modules are needed (ActiveDirectory, Az, ExchangeOnlineManagement, Microsoft.Graph, etc.)
3. **Generate Script**: Create complete, working PowerShell script with:
   - Proper [CmdletBinding()] and parameters
   - Error handling (try-catch blocks)
   - Logging (Write-Verbose, Write-Error)
   - Module imports with version requirements
   - Input validation
   - Comments and documentation
4. **Save Script**: Save to `scripts/[Category]/[Descriptive-Name].ps1`
5. **Provide Instructions**: Include prerequisites, usage examples, expected output

## Examples

### Example 1: Active Directory User Management

**Command**:
```bash
/ps-script "Bulk create AD users from CSV file with email, department, and manager. Include error logging for failed accounts."
```

**Generated Script Location**: `scripts/AD/Bulk-Create-Users-From-CSV.ps1`

**Process**:
1. Context7: Fetch latest `ActiveDirectory` module cmdlets (`New-ADUser`, `Set-ADUser`)
2. Generate script with:
   - CSV import with validation
   - User creation loop with progress reporting
   - Manager assignment using distinguishedName
   - Error logging to separate file
   - Summary report
3. Include prerequisites (AD PowerShell module, permissions needed)

---

### Example 2: Azure VM Status Report

**Command**:
```bash
/ps-script "Generate report of all Azure VMs showing name, status, size, resource group, and tags. Export to CSV."
```

**Generated Script Location**: `scripts/Azure/Azure-VM-Status-Report.ps1`

**Process**:
1. Context7: Fetch latest `Az.Compute` module cmdlets
2. Generate script with:
   - Azure authentication (Connect-AzAccount)
   - VM query across all subscriptions
   - Tag extraction and formatting
   - CSV export with proper encoding
3. Include cost estimation notes if relevant

---

### Example 3: Exchange Mailbox Size Report

**Command**:
```bash
/ps-script "Get mailbox sizes for all users, include archive size if enabled, sort by total size descending, export to CSV"
```

**Generated Script Location**: `scripts/Exchange/Mailbox-Size-Report.ps1`

**Process**:
1. Context7: Fetch latest `ExchangeOnlineManagement` module
2. Generate script with:
   - Exchange Online authentication
   - Get-EXOMailbox and Get-EXOMailboxStatistics
   - Archive size calculation
   - Sorting and formatting
   - CSV export

---

### Example 4: M365 License Assignment

**Command**:
```bash
/ps-script "Assign Microsoft 365 E3 licenses to users from CSV. Check if license available before assignment. Log successes and failures."
```

**Generated Script Location**: `scripts/M365/Assign-M365-Licenses-From-CSV.ps1`

**Process**:
1. Context7: Fetch latest `Microsoft.Graph.Users` cmdlets
2. Generate script with:
   - Microsoft Graph authentication with proper scopes
   - License availability check
   - License assignment with error handling
   - Detailed logging
   - Summary report

---

## Script Standards

Every generated script includes:

### Header
```powershell
<#
.SYNOPSIS
    Brief description

.DESCRIPTION
    Detailed description of what the script does

.PARAMETER ParameterName
    Description of parameter

.EXAMPLE
    Example usage with expected output

.NOTES
    Author: Generated by Claude Code
    Prerequisites:
    - Required modules (with versions)
    - Required permissions
    - Required access
#>
```

### Structure
```powershell
[CmdletBinding()]
param(
    [Parameter(Mandatory=$true, HelpMessage="Description")]
    [ValidateNotNullOrEmpty()]
    [string]$Parameter
)

# Module imports
Import-Module ModuleName -ErrorAction Stop

try {
    Write-Verbose "Starting operation..."

    # Input validation

    # Main logic with progress reporting

    # Output results

    Write-Verbose "Operation completed successfully"
}
catch {
    Write-Error "Operation failed: $_"
    # Cleanup if needed
    throw
}
finally {
    # Cleanup resources
}
```

### Error Handling
- Try-catch for all external operations
- Meaningful error messages
- Cleanup in finally block if needed
- Error logging to file for batch operations

### Logging
- Write-Verbose for operation progress
- Write-Warning for non-critical issues
- Write-Error for failures
- Optional log file for batch operations

---

## Integration

- **Context7 MCP**: Fetches latest module documentation before code generation
- **PowerShell Builder Agent**: Automatically activated for complex scripts
- **Sequential Thinking**: Used for complex logic planning

---

## Supported Technologies

- **Active Directory**: User/group/computer management, GPO, replication
- **Azure**: Resource management, deployments, monitoring (Az module)
- **Microsoft Graph**: M365, AAD, Teams, SharePoint operations
- **Exchange**: On-premises and Exchange Online management
- **Microsoft 365**: Licensing, compliance, Teams, SharePoint
- **Purview**: Compliance, DLP, retention policies
- **General**: File operations, API calls, data processing

---

## Best Practices Applied

- ✅ Latest cmdlet versions (via Context7)
- ✅ Proper error handling
- ✅ Input validation
- ✅ Credential security (no hardcoding)
- ✅ Progress reporting
- ✅ Comprehensive comments
- ✅ Example usage
- ✅ Prerequisites documented

---

## Related Commands

- `/ps-gui "[description]"` - Same script but with Windows Forms GUI
- `/ps-graph "[description]"` - Specialized for Microsoft Graph operations
- `/ps-azure "[description]"` - Specialized for Azure operations
- `@powershell-builder` - Invoke PowerShell expert agent directly

---

## Tips for Best Results

1. **Be Specific**: "Create AD users from CSV" vs "Bulk create 100 AD users from CSV located at C:\import.csv with columns: FirstName, LastName, Email, Department"

2. **Include Requirements**: Mention error handling, logging, progress bars, email notifications

3. **Specify Output**: "Export to CSV", "Send email report", "Display in grid"

4. **Mention Constraints**: "Use existing CSV format", "Must run on Windows Server 2016", "Low memory environment"
